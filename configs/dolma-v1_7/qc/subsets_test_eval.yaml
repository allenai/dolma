streams:

  - name: books
    documents:
      - s3://ai2-llm/pretraining-data/sources/pile/v1/documents/test/books3/*.gz
    attributes:
      - random_number_v1
    output:
      path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/whose_quality_corpus/documents/test/books
      max_size_in_bytes: 5_604_566_529  # about 10 files
      discard_fields:
        - metadata
        - attributes
    filter:
      include:
          - "$.attributes[?(@.random_number_v1__random_number_v1__random[0][2] < 2)]"

  - name: books
    documents:
      - s3://ai2-llm/pretraining-data/sources/pile/v1/documents/val/books3/*.gz
    attributes:
      - random_number_v1
    output:
      path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/whose_quality_corpus/documents/valid/books
      max_size_in_bytes: 5_604_566_529  # about 10 files
      discard_fields:
        - metadata
        - attributes
    filter:
      include:
          - "$.attributes[?(@.random_number_v1__random_number_v1__random[0][2] < 2)]"


  - name: openwebtext2
    documents:
      - s3://ai2-llm/pretraining-data/sources/pile/v1/documents/test/openwebtext2/*.gz
    attributes:
      - random_number_v1
    output:
      path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/whose_quality_corpus/documents/test/openwebtext2
      max_size_in_bytes: 5_075_431_452  # about 10 files
      discard_fields:
        - metadata
        - attributes
    filter:
      include:
          - "$.attributes[?(@.random_number_v1__random_number_v1__random[0][2] < 2)]"


  - name: openwebtext2
    documents:
      - s3://ai2-llm/pretraining-data/sources/pile/v1/documents/val/openwebtext2/*.gz
    attributes:
      - random_number_v1
    output:
      path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/whose_quality_corpus/documents/valid/openwebtext2
      max_size_in_bytes: 5_075_431_452  # about 10 files
      discard_fields:
        - metadata
        - attributes
    filter:
      include:
          - "$.attributes[?(@.random_number_v1__random_number_v1__random[0][2] < 2)]"



  - name: megawika
    documents:
      - s3://ai2-llm/pretraining-data/sources/megawika/v0/documents/en/*.gz
    attributes:
      - random_number_v1
    output:
      path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/whose_quality_corpus/documents/test/megawika
      max_size_in_bytes: 2_332_602_944  # about 10 files
      discard_fields:
        - metadata
        # - attributes
    filter:
      include:
          - "$.attributes[?(@.random_number_v1__random_number_v1__random[0][2] > 0.20 && @.random_number_v1__random_number_v1__random[0][2] < 0.21)]"

  - name: megawika
    documents:
      - s3://ai2-llm/pretraining-data/sources/megawika/v0/documents/en/*.gz
    attributes:
      - random_number_v1
    output:
      path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/whose_quality_corpus/documents/valid/megawika
      max_size_in_bytes: 2_332_602_944  # about 10 files
      discard_fields:
        - metadata
        - attributes
    filter:
      include:
          - "$.attributes[?(@.random_number_v1__random_number_v1__random[0][2] > 0.30 && @.random_number_v1__random_number_v1__random[0][2] < 0.31)]"


  - name: dolma_wiki
    documents:
      - s3://ai2-llm/pretraining-data/sources/olmo-mix/v1_5r2/documents/wiki/*.gz
    attributes:
      - random_number_v1
    output:
      path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/whose_quality_corpus/documents/valid/dolma_wiki
      max_size_in_bytes: 2_332_602_944  # about 10 files
      discard_fields:
        - metadata
        - attributes
    filter:
      include:
          - "$.attributes[?(@.random_number_v1__random_number_v1__random[0][2] > 0.35 && @.random_number_v1__random_number_v1__random[0][2] < 0.37)]"

  - name: dolma_wiki
    documents:
      - s3://ai2-llm/pretraining-data/sources/olmo-mix/v1_5r2/documents/wiki/*.gz
    attributes:
      - random_number_v1
    output:
      path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/whose_quality_corpus/documents/test/dolma_wiki
      max_size_in_bytes: 2_332_602_944  # about 10 files
      discard_fields:
        - metadata
        - attributes
    filter:
      include:
          - "$.attributes[?(@.random_number_v1__random_number_v1__random[0][2] > 0.45 && @.random_number_v1__random_number_v1__random[0][2] < 0.47)]"

  - name: dolma_pes2o
    documents: &dolma_pes2o
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2ag/split=valid/part_id=0/*.gz
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2ag/split=valid/part_id=1/*.gz
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2ag/split=valid/part_id=2/*.gz
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2ag/split=valid/part_id=3/*.gz
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2ag/split=valid/part_id=4/*.gz
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2ag/split=valid/part_id=5/*.gz
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2ag/split=valid/part_id=6/*.gz
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2ag/split=valid/part_id=7/*.gz
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2ag/split=valid/part_id=8/*.gz
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2ag/split=valid/part_id=9/*.gz
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2orc/split=valid/part_id=0/*.gz
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2orc/split=valid/part_id=1/*.gz
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2orc/split=valid/part_id=2/*.gz
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2orc/split=valid/part_id=3/*.gz
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2orc/split=valid/part_id=4/*.gz
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2orc/split=valid/part_id=5/*.gz
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2orc/split=valid/part_id=6/*.gz
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2orc/split=valid/part_id=7/*.gz
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2orc/split=valid/part_id=8/*.gz
      - s3://ai2-llm/pretraining-data/sources/s2/v3-fos/documents/dataset=s2orc/split=valid/part_id=9/*.gz
    attributes:
      - random_number_v1
    output:
      path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/whose_quality_corpus/documents/valid/dolma_pes2o
      max_size_in_bytes: 10_619_262_881  # about 10 files
      discard_fields:
        - metadata
        - attributes
    filter:
      include:
          - "$.attributes[?(@.random_number_v1__random_number_v1__random[0][2] < 0.20)]"

  - name: dolma_pes2o
    documents: *dolma_pes2o
    attributes:
      - random_number_v1
    output:
      path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/whose_quality_corpus/documents/test/dolma_pes2o
      max_size_in_bytes: 10_619_262_881  # about 10 files
      discard_fields:
        - metadata
        - attributes
    filter:
      include:
          - "$.attributes[?(@.random_number_v1__random_number_v1__random[0][2] > 0.80)]"

processes: 20
