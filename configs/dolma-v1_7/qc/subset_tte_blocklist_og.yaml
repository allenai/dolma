streams:
  - name: adult
    documents: &documents
      - s3://ai2-llm/pretraining-data/sources/common-crawl/abl-cc-v1-small-dedup/documents/*.gz
    attributes:
      - url_filtering
    output: &output
      max_size_in_bytes: 52_179_272_016
      path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/whose_quality_corpus/documents/all/cc_dedup_adult
      # discard_fields:
      #   - attributes
      #   - metadata
    filter:
      include:
        - "$.attributes[?(@['url_filtering__blocklist_hosts_porn_v1__url'] && !@['url_filtering__allowlist_wikidata_cleaned_v1__url'])]"
        - "$.attributes[?(@['url_filtering__domain_blocklist_utp_v1__url'] && !@['url_filtering__allowlist_wikidata_cleaned_v1__url'])]"

  - name: wikidata
    documents: *documents
    attributes:
      - url_filtering
    output:
      <<: *output
      path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/whose_quality_corpus/documents/all/cc_dedup_wikidata
    filter:
      include:
        - "$.attributes[?(@['url_filtering__allowlist_wikidata_cleaned_v1__url'] && @.url_filtering__random_number_v1__random[0][2] < 0.01)]"

  - name: cloudflare
    documents: *documents
    attributes:
      - url_filtering
    output:
      <<: *output
      path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/whose_quality_corpus/documents/all/cc_dedup_cloudflare/
    filter:
      include:
        - "$@.attributes[?(@.url_filtering__cloudflare_rank_v1__url && @.url_filtering__cloudflare_rank_v1__url[0] && @.url_filtering__cloudflare_rank_v1__url[0][2] <= 4.0 && @.url_filtering__random_number_v1__random[0][2] < 0.015)]"


  - name: gambling
    documents: *documents
    attributes: &attributes
      - url_filtering
    output:
      <<: *output
      path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/whose_quality_corpus/documents/all/cc_dedup_gambling/
    filter:
      include:
        - "$.attributes[?(@['url_filtering__blocklist_hosts_gambling_v1__url'] && !@['url_filtering__allowlist_wikidata_cleaned_v1__url'])]"

  - name: adware_malware
    documents: *documents
    attributes: *attributes
    output:
      <<: *output
      path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/whose_quality_corpus/documents/all/cc_dedup_maladware/
    filter:
      include:
        - "$.attributes[?(@['url_filtering__blocklist_hosts_adware_malware_v1__url'] && !@['url_filtering__allowlist_wikidata_cleaned_v1__url'])]"

  - name: fakenews
    documents: *documents
    attributes: *attributes
    output:
      <<: *output
      path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/whose_quality_corpus/documents/all/cc_dedup_fakenews/
    filter:
      include:
        - "$.attributes[?(@['url_filtering__blocklist_hosts_fakenews_v1__url'])]"


work_dir:
  input: "/tmp/blocklist_qc/input"
  output: "/tmp/blocklist_qc/output"
processes: 188
