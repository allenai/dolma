streams:
  - name: cc_head_dd10
    documents:
      - s3://ai2-llm/pretraining-data/sources/olmo-mix/v1_5r2/documents/cc_en_head/cc_en_head-0091.json.gz
    attributes:
      - dedupe_para_ngrams_13_1
    output:
      max_size_in_bytes: 38949672960
      path: ${oc.env:HOME}/duplicates
      # discard_fields:
      #   - attributes
      #   - metadata
    filter:
      include:
        - >-
          (.attributes.dedupe_para_ngrams_13_1 | length > 0) and
          ((.attributes.dedupe_para_ngrams_13_1 | map(.[2] * (.[1] - .[0])) | add) / (.text | length) > 0.1)
      syntax: jq


  - name: cc_middle_dd10
    documents:
      - s3://ai2-llm/pretraining-data/sources/olmo-mix/v1_5r2/documents/cc_en_middle/cc_en_middle-0091.json.gz
    attributes:
      - dedupe_para_ngrams_13_1
    output:
      max_size_in_bytes: 38949672960
      path: ${oc.env:HOME}/duplicates
      # discard_fields:
      #   - attributes
      #   - metadata
    filter:
      include:
        - >-
          (.attributes.dedupe_para_ngrams_13_1 | length > 0) and
          ((.attributes.dedupe_para_ngrams_13_1 | map(.[2] * (.[1] - .[0])) | add) / (.text | length) > 0.1)
      syntax: jq


  - name: cc_tail_dd10
    documents:
      - s3://ai2-llm/pretraining-data/sources/olmo-mix/v1_5r2/documents/cc_en_tail/cc_en_tail-0091.json.gz
    attributes:
      - dedupe_para_ngrams_13_1
    output:
      max_size_in_bytes: 38949672960
      path: ${oc.env:HOME}/duplicates
      # discard_fields:
      #   - attributes
      #   - metadata
    filter:
      include:
        - >-
          (.attributes.dedupe_para_ngrams_13_1 | length > 0) and
          ((.attributes.dedupe_para_ngrams_13_1 | map(.[2] * (.[1] - .[0])) | add) / (.text | length) > 0.1)
      syntax: jq

  - name: falcon_dd10
    documents:
      - s3://ai2-llm/pretraining-data/sources/falcon-refinedweb/v0-0.05-heldout-complement/documents/91*
    attributes:
      - dedupe_para_ngrams_13_1
    output:
      max_size_in_bytes: 38949672960
      path: ${oc.env:HOME}/duplicates
      # discard_fields:
      #   - attributes
      #   - metadata
    filter:
      include:
        - >-
          (.attributes.dedupe_para_ngrams_13_1 | length > 0) and
          ((.attributes.dedupe_para_ngrams_13_1 | map(.[2] * (.[1] - .[0])) | add) / (.text | length) > 0.1)
      syntax: jq


work_dir:
  input: "/tmp/c4_mix/input"
  output: "/tmp/c4_mix/output"
processes: 188
