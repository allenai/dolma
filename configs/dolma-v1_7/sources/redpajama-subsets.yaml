streams:

  - name: arxiv
    documents:
        - s3://ai2-llm/pretraining-data/sources/redpajama/v1/documents/split=train/dataset=arxiv/*.gz
    attributes:
      - paloma_paragraphs
      - paloma_documents
    output:
      path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/redpajama/v1_decon_fix/documents/train/arxiv
      max_size_in_bytes: 104_857_600
    filter:
      exclude:
        - "$@.attributes[?(@.paloma_paragraphs && @.paloma_paragraphs[0] && @.paloma_paragraphs[0][2] >= 0)]"
        - "$@.attributes[?(@.paloma_documents && @.paloma_documents[0] && @.paloma_documents[0][2] >= 0)]"

  - name: stackexchange
    documents:
        - s3://ai2-llm/pretraining-data/sources/redpajama/v1/documents/split=train/dataset=stackexchange/*.gz
    attributes:
      - paloma_paragraphs
      - paloma_documents
    output:
      path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/redpajama/v1_decon_fix/documents/train/stackexchange
      max_size_in_bytes: 26_214_400
    filter:
      exclude:
        - "$@.attributes[?(@.paloma_paragraphs && @.paloma_paragraphs[0] && @.paloma_paragraphs[0][2] >= 0)]"
        - "$@.attributes[?(@.paloma_documents && @.paloma_documents[0] && @.paloma_documents[0][2] >= 0)]"

processes: 96
