streams:

  - name: algebraic-stack-train
    documents:
        - 's3://ai2-llm/pretraining-data/sources/proof-pile-2/v0/documents/algebraic-stack/train/*.gz'
    attributes: &attributes
      - paloma_paragraphs
      - paloma_documents
    output: &output
      path: s3://ai2-llm/pretraining-data/sources/proof-pile-2/v0_decontaminated/documents/algebraic-stack/train
      max_size_in_bytes: 104_857_600
    filter: &filter_docs
      exclude:
        - "$@.attributes[?(@.paloma_documents && @.paloma_documents[0] && @.paloma_documents[0][2] >= 0)]"

  - name: algebraic-stack-validation
    documents:
        - 's3://ai2-llm/pretraining-data/sources/proof-pile-2/v0/documents/algebraic-stack/validation/*.gz'
    attributes: *attributes
    output:
      <<: *output
      path: s3://ai2-llm/pretraining-data/sources/proof-pile-2/v0_decontaminated/documents/algebraic-stack/validation
    filter: *filter_docs

  - name: algebraic-stack-test
    documents:
        - 's3://ai2-llm/pretraining-data/sources/proof-pile-2/v0/documents/algebraic-stack/test/*.gz'
    attributes: *attributes
    output:
      <<: *output
      path: s3://ai2-llm/pretraining-data/sources/proof-pile-2/v0_decontaminated/documents/algebraic-stack/test
    filter: *filter_docs




  - name: arxiv-train
    documents:
        - 's3://ai2-llm/pretraining-data/sources/proof-pile-2/v0/documents/arxiv/train/*.gz'
    attributes: *attributes
    output:
      <<: *output
      path: s3://ai2-llm/pretraining-data/sources/proof-pile-2/v0_decontaminated/documents/arxiv/train
    filter: &filter
      exclude:
        - "$@.attributes[?(@.paloma_paragraphs && @.paloma_paragraphs[0] && @.paloma_paragraphs[0][2] >= 0)]"
        - "$@.attributes[?(@.paloma_documents && @.paloma_documents[0] && @.paloma_documents[0][2] >= 0)]"

  - name: arxiv-validation
    documents:
        - 's3://ai2-llm/pretraining-data/sources/proof-pile-2/v0/documents/arxiv/validation/*.gz'
    attributes: *attributes
    output:
      <<: *output
      path: s3://ai2-llm/pretraining-data/sources/proof-pile-2/v0_decontaminated/documents/arxiv/validation
    filter: *filter

  - name: arxiv-test
    documents:
        - 's3://ai2-llm/pretraining-data/sources/proof-pile-2/v0/documents/arxiv/test/*.gz'
    attributes: *attributes
    output:
      <<: *output
      path: s3://ai2-llm/pretraining-data/sources/proof-pile-2/v0_decontaminated/documents/arxiv/test
    filter: *filter



  - name: open-web-math-train
    documents:
        - 's3://ai2-llm/pretraining-data/sources/proof-pile-2/v0/documents/open-web-math/train/*.gz'
    attributes: *attributes
    output:
      <<: *output
      path: s3://ai2-llm/pretraining-data/sources/proof-pile-2/v0_decontaminated/documents/open-web-math/train
    filter: *filter

  - name: open-web-math-validation
    documents:
        - 's3://ai2-llm/pretraining-data/sources/proof-pile-2/v0/documents/open-web-math/validation/*.gz'
    attributes: *attributes
    output:
      <<: *output
      path: s3://ai2-llm/pretraining-data/sources/proof-pile-2/v0_decontaminated/documents/open-web-math/validation
    filter: *filter
  - name: open-web-math-test
    documents:
        - 's3://ai2-llm/pretraining-data/sources/proof-pile-2/v0/documents/open-web-math/test/*.gz'
    attributes: *attributes
    output:
      <<: *output
      path: s3://ai2-llm/pretraining-data/sources/proof-pile-2/v0_decontaminated/documents/open-web-math/test
    filter: *filter

processes: 188
