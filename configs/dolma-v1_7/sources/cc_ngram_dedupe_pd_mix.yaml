streams:
  - name: cc_en_head
    documents:
      - s3://ai2-llm/pretraining-data/sources/olmo-mix/v1_5r2/documents/cc_en_head/*
    attributes:
      - dedupe_para_ngrams_13_1
    output:
      max_size_in_bytes: 3894967296
      path: s3://ai2-llm/pretraining-data/sources/olmo-mix/v1_7_dd_ngram_docpara_le030/documents/cc_en_head
      min_text_length: 25   # matches wikipedia
      # discard_fields:
      #   - attributes
      #   - metadata
    filter:
      include:
        - >-
          (.attributes.dedupe_para_ngrams_13_1 | length == 0) or
          ((.attributes.dedupe_para_ngrams_13_1 | map(.[2] * (.[1] - .[0])) | add) / (.text | length) <= 0.3)
      syntax: jq
    span_replacement:
      - span: "$.attributes.dedupe_para_ngrams_13_1"
        min_score: 0.8
        replacement: ''


  - name: cc_en_middle
    documents:
      - s3://ai2-llm/pretraining-data/sources/olmo-mix/v1_5r2/documents/cc_en_middle/*
    attributes:
      - dedupe_para_ngrams_13_1
    output:
      max_size_in_bytes: 3894967296
      path: s3://ai2-llm/pretraining-data/sources/olmo-mix/v1_7_dd_ngram_docpara_le030/documents/cc_en_middle
      min_text_length: 25   # matches wikipedia
      # discard_fields:
      #   - attributes
      #   - metadata
    filter:
      include:
        - >-
          (.attributes.dedupe_para_ngrams_13_1 | length == 0) or
          ((.attributes.dedupe_para_ngrams_13_1 | map(.[2] * (.[1] - .[0])) | add) / (.text | length) <= 0.3)
      syntax: jq
    span_replacement:
      - span: "$.attributes.dedupe_para_ngrams_13_1"
        min_score: 0.8
        replacement: ''


  - name: cc_en_tail
    documents:
      - s3://ai2-llm/pretraining-data/sources/olmo-mix/v1_5r2/documents/cc_en_tail/*
    attributes:
      - dedupe_para_ngrams_13_1
    output:
      max_size_in_bytes: 3894967296
      path: s3://ai2-llm/pretraining-data/sources/olmo-mix/v1_7_dd_ngram_docpara_le030/documents/cc_en_tail
      min_text_length: 25   # matches wikipedia
      # discard_fields:
      #   - attributes
      #   - metadata
    filter:
      include:
        - >-
          (.attributes.dedupe_para_ngrams_13_1 | length == 0) or
          ((.attributes.dedupe_para_ngrams_13_1 | map(.[2] * (.[1] - .[0])) | add) / (.text | length) <= 0.3)
      syntax: jq
    span_replacement:
      - span: "$.attributes.dedupe_para_ngrams_13_1"
        min_score: 0.8
        replacement: ''


work_dir:
  input: "/tmp/cc_ngram_dedupe_pd_mix/input"
  output: "/tmp/cc_ngram_dedupe_pd_mix/output"

processes: 128
