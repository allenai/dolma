
# streams:
#   - name: cccc-CC-MAIN-2022-05
#     documents:
#     - s3://ai2-llm/pretraining-data/sources/cccc/v1_gopher_fix/documents/CC-MAIN-2022-05/*.gz
#     attributes:
#       - dedupe_doc
#       - dedupe_para
#     output:
#       max_size_in_bytes: 2_000_000_000
#       path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/cccc/v2/documents/CC-MAIN-2022-05
#     filter:
#       syntax: jq
#       exclude:
#         # Exact duplicates
#         - (.attributes.dedupe_doc != null)

#         # Fuzzy duplicates with above 0.5 of shared ngrams (TO CHANGE)
#         - >-
#           (.attributes.dedupe_para | length == 0) or
#           ((.attributes.dedupe_para | map(.[2] * (.[1] - .[0])) | add) / (.text | length) <= 0.5)

# processes: 100

streams:
  - name: cccc-CC-MAIN-2022-05
    documents:
    - s3://ai2-llm/pretraining-data/sources/cccc/v1_gopher_fix/documents/CC-MAIN-2022-05/*.gz
    attributes:
      - dedupe_para_test
    output:
      max_size_in_bytes: 2_000_000_000
      path: ${oc.env:HOME}/ai2-llm/pretraining-data/sources/cccc/v2-test/documents/CC-MAIN-2022-05
    filter:
      syntax: jq
      include:
        - (.attributes.dedupe_para_test | length > 0)

# work_dir:
#   input: "/tmp/cccc-CC-MAIN-2022-05/mix/input"
#   output: "/tmp/cccc-CC-MAIN-2022-05/mix/output"

processes: 100
