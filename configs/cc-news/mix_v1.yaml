streams:
    - name: cc-news_${oc.env:MIX_YEAR}-${oc.env:MIX_MONTH}
      documents:
        - s3://ai2-llm/pretraining-data/sources/cc-news/v0-resiliparse/documents/${oc.env:MIX_YEAR}-${oc.env:MIX_MONTH}/*.zst

      compression:
        input: zst
        output: zst

      output:
        path: s3://ai2-llm/pretraining-data/sources/cc-news/v1-resiliparse/documents/${oc.env:MIX_YEAR}-${oc.env:MIX_MONTH}
        max_size_in_bytes: 1_000_000_000

      attributes:
        - dedupe_ngrams_13_1

      filter:
        exclude:
          - >-
           (.attributes.dedupe_ngrams_13_1 | length > 0) and
           ((.attributes.dedupe_ngrams_13_1 | map(.[2] * (.[1] - .[0])) | add) / (.text | length) >= 0.5)

      syntax: jq

processes: 1
